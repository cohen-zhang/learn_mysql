# 一条更新语句的执行

与查询语句的执行不一样，更新语句的执行会涉及到日志系统的使用。即 redo log 和 binlog 的使用。

## 1. 一条更新语句的执行流程

和查询语句的执行流程类似，更新语句的执行流程也是分为三个阶段：**解析器、优化器和执行器**。
只不过，更新语句的执行流程会多出一个步骤，就是**日志系统**。

## 2. 日志系统

日志系统主要包括两个部分：redo log 和 binlog。

### 2.1 InnoDB 引擎的 redo log

redo log 是 `InnoDB` 引擎特有的日志，它**是物理日志**，记录的是“在某个数据页上做了什么修改”。
设计思路是每隔一段时间，就将 redo log 记录的这段时间的所有修改都更新到磁盘上的数据页上。即 **WAL 技术**。

关键是先写日志，再写磁盘。

redo log 是固定大小的，比如可以配置为一组 4 个文件，每个文件的大小是 1GB，那么这块日志的总大小就是 4GB。
当写满所有的 redo log 之后，再从头开始写。即 **循环写**。

示意图如下：
[![image.png](https://i.postimg.cc/3wZQJXZ3/image.png)](https://postimg.cc/9wZQJXZ3)

redo log 的大小设置，是一个性能调优的参数，redo log 越大，表示每次写磁盘的操作就越少，性能就越好。
但是，redo log 太大，意味着系统发生 crash 时，恢复的速度就会越慢。

有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 **crash-safe**。

### 2.2 MySQL 的 binlog（归档日志）

binlog 是 MySQL 的 Server 层实现的，所有引擎都可以使用。
binlog 是**逻辑日志**，它记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”。


