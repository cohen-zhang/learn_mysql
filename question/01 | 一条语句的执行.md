# 01 | 基础架构：一条SQL查询语句是如何执行的？

## 问题

1. MySQL 从V5.5.5版本后默认的存储引擎就是 InnoDB； 
2. MySQL 的两层逻辑架构图

![MySQL的两层逻辑架构图](https://static001.geekbang.org/resource/image/6f/1b/6f6b4a4b4d3b6b3b6b3b3b3b3b3b1b6f.png)

除了存储数据，提供读写接口在存储引擎层，还有一些额外的功能，比如权限管理、复制、备份等等。这些功能模块都在 Server 层实现，跟存储引擎没有关系。

### 连接器

```sql
-- 最常用的连接命令
mysql -h$ip -P$port -u$user -p
```

使用 show processlist 命令可以看到当前所有的连接，以及这些连接正在执行的命令。如果连接数太多，可以用 kill 命令来杀掉一些连接。

```sql
-- 查看当前连接, 以及正在执行的命令，给出 Query 、Sleep 、Killed 等状态的Demo
mysql> show processlist;
+----+------+-----------------+------+---------+------+-------+------------------+
| Id | User | Host            | db   | Command | Time | State | Info             |
+----+------+-----------------+------+---------+------+-------+------------------+
|  3 | root | localhost:49334 | NULL | Sleep   |  110 |       | NULL             |
|  4 | root | localhost:49335 | NULL | Sleep   |    3 |       | NULL             |
|  5 | root | localhost:49336 | NULL | Query   |    0 | init  | show processlist |
+----+------+-----------------+------+---------+------+-------+------------------+
3 rows in set (0.00 sec)
```

- Id：连接的线程ID。这个是MySQL自动生成的，每一个新连接的线程都会有一个唯一的ID。如果连接断了，线程会自动消失。
- User：连接所用的MySQL账户名。这个可能会和你登录MySQL的用户名不一致。因为MySQL有个偷懒的机制，允许你用一个账户名，连接成功之后，再通过 `mysql -u -p` 的方式，用其他账户名来操作。
- Host：连接的来源地址。这个可以帮助我们定位产生问题的客户端应用程序。如果是本机的话，就是 localhost 或者


